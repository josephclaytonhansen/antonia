$((function () { let t = $("#flipbook"); t && t.length || (t = $(document)); const e = t.find(".book"); t.find(".cover"), t.find(".back"); let n = !1; const a = document.querySelector(".page-scroll-spacer"); function o(t) { if (null == t) return null; const e = String(t).trim(); if (!e.length) return null; if (e.endsWith("%")) { const t = parseFloat(e.slice(0, -1)); return isNaN(t) ? null : Math.max(0, Math.min(1, t / 100)) } const n = parseFloat(e); return isNaN(n) ? null : n > 1 ? Math.max(0, Math.min(1, n / 100)) : Math.max(0, Math.min(1, n)) } const s = a && a.dataset && (a.dataset.openStart || a.dataset.start), l = a && a.dataset && (a.dataset.openEnd || a.dataset.end); let d = null; try { d = e && e[0] ? e[0].closest("[data-open-start],[data-start],[data-open-end],[data-end]") : null } catch (t) { d = null } const i = d && d.dataset ? d.dataset.openStart || d.dataset.start : null, r = d && d.dataset ? d.dataset.openEnd || d.dataset.end : null, c = o(null != s ? s : i), u = o(null != l ? l : r); function p(t) { if (null == t) return null; const e = parseFloat(String(t).trim()); return isNaN(e) ? null : e } const h = a && a.dataset && a.dataset.openBoost || null, g = d && d.dataset && d.dataset.openBoost || null, f = e && e[0] && e[0].dataset && e[0].dataset.openBoost || null, m = a && a.dataset && (a.dataset.openBoostLeft || a.dataset.openboostleft) || null, w = d && d.dataset && (d.dataset.openBoostLeft || d.dataset.openboostleft) || null, M = e && e[0] && e[0].dataset && (e[0].dataset.openBoostLeft || e[0].dataset.openboostleft) || null, b = a && a.dataset && (a.dataset.openBoostRight || a.dataset.openboostright) || null, E = d && d.dataset && (d.dataset.openBoostRight || d.dataset.openboostright) || null, x = e && e[0] && e[0].dataset && (e[0].dataset.openBoostRight || e[0].dataset.openboostright) || null, v = p(null != h ? h : null != g ? g : f), y = p(null != m ? m : null != w ? w : M), B = p(null != b ? b : null != E ? E : x), k = null != y ? y : null != v ? v : 20, L = null != B ? B : null != v ? v : 20; const S = a && a.dataset && (a.dataset.openEasing || a.dataset.openeasing) || null, N = d && d.dataset && (d.dataset.openEasing || d.dataset.openeasing) || null, H = e && e[0] && e[0].dataset && (e[0].dataset.openEasing || e[0].dataset.openeasing) || null, F = null != S ? S : null != N ? N : H, Y = F && "none" === String(F).toLowerCase() ? function (t) { return t } : function (t) { return 1 - Math.pow(1 - t, 3) }; function q(n) { n = Math.max(0, Math.min(1, n)); const a = Y(n); try { e[0].style.setProperty("--book-turn", a) } catch (t) { } const o = Math.max(0, Math.min(1, (a - .05) / .95)); t.find(".spine").css("opacity", o); const s = Math.min(10, 18 * a), l = 1 + .1 * a, d = .2 * a; Object.entries({ ".front": -160, ".page1": -150, ".page2": -30, ".page3": -140, ".page4": -40, ".page5": -130, ".page6": -50, ".back": -20 }).forEach((([t, n]) => { try { const o = e.find(t); if (o.length) { const e = (n + ([".front", ".page1", ".page3", ".page5"].includes(t) ? L : k)) * a; ".back" === t ? o.css("transform", `rotateY(${e}deg) scale(${l}) translateX(${-s}px)`) : o.css("transform", `rotateY(${e}deg) scale(${l})`), ".back" !== t && o.css("box-shadow", `0 1em 3em 0 rgba(0,0,0,${d})`) } } catch (t) { } })) } function R() { n || (n = !0, requestAnimationFrame((() => { q(function () { const t = window.scrollY || window.pageYOffset || document.documentElement.scrollTop, e = t / Math.max(1, document.documentElement.scrollHeight - window.innerHeight); if (null != c && null != u && u > c) { const t = (e - c) / (u - c); return Math.max(0, Math.min(1, t)) } if (a && a instanceof Element) { const e = a.offsetTop, n = a.offsetHeight || 1, o = e - (window.innerHeight || document.documentElement.clientHeight), s = (t - o) / (e + n - o || 1); return Math.max(0, Math.min(1, s)) } return Math.max(0, Math.min(1, e)) }()), n = !1 }))) } q(0), function () { if (!window.matchMedia || !window.matchMedia("(hover: none)").matches) try { e.css("pointer-events", "none"), e.find(".front, .page1, .page2, .page3, .page4, .page5, .page6, .back").css("pointer-events", "auto") } catch (t) { } }(), window.addEventListener("scroll", R, { passive: !0 }), window.addEventListener("wheel", R, { passive: !0 }), window.addEventListener("resize", (() => { R() })), function () { const t = document.querySelector(".page-scroll-spacer"); t && (t.style.height = "300vh") }() }));